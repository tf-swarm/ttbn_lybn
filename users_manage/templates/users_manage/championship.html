{% load extratags %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link type="text/css" rel="stylesheet" href="/static/css/red_popup.css">
    <link rel="stylesheet" type="text/css" href="/static/css/easyui.css">
    <link type="text/css" rel="stylesheet" href="/static/css/load.css">
    <link type="text/css" rel="stylesheet" href="/static/css/laydate.css">
    <link type="text/css" rel="stylesheet" href="/static/css/ht_style.css">
    <link type="text/css" rel="stylesheet" href="/static/css/switch.css">
    <link type="text/css" rel="stylesheet" href="/static/css/fixed_header.css">
    <link type="text/css" rel="stylesheet" href="/static/css/red_packet.css">

    <script type="text/javascript" src="/static/js/jquery-2.0.0.min.js"></script>
    <script type="text/javascript" src="/static/laydate.js"></script>
    <script type="text/javascript" src="/static/js/hint.js"></script>
    <script type="text/javascript" src="/static/js/load-min.js"></script>
    <script type="text/javascript" src="/static/js/jquery.easyui.min.js"></script>

    <script>
        var w,h,className;
        function getSrceenWH(){
            w = $(window).width();
            h = $(window).height();
            $('#dialogBg').width(w).height(h);
        }
        $(function(){
            //全选全消
            $('#check_all').click(function () {
                var checked = $(this).prop('checked');
                $(':checkbox:not(#check_all)').prop('checked',checked)
            });

            //单个选中
            $(':checkbox:not(#check_all)').click(function () {
                //$(':checkbox:not(#check_all)') 拿到所有的checkbox选择框,但除去有#check_all标签的选择框
                var checkbox=$(':checkbox:not(#check_all)').length;
                var checked = $(':checked:not(#check_all)').length;
                $('#check_all').prop('checked',checkbox==checked);
            });

            $('#paging').click(function (){
                var pag = $('.pagination-num').val() ;
                var URL= "{{url_date}}?page=" + pag;
                location.href=URL;
            });

            $('#export_data').click(function () {
                var URL= "/users_manage/particulars_excel{{ game_type }}/";
                location.href=URL;
            });

            var error_start = false;
            var error_end = false;

            $('#query_data').click(function(){
                check_time();
                if(error_start == true && error_end == true)
                {
                    $.Load_data();
                    $("#form_search").submit();
                    return true;
                }
                else
                {
                    return false;
                }
            });

            function check_time(){
                var len_start = $('#start').val().length;
                var len_end = $('#end').val().length;
                if(len_start==0 || len_end==0)
                {
                    $.MsgBox.Alert("系统提示", "请输入日期!");
                    error_start = false;
                    error_end = false;
                }
                else
                {
                    error_start = true;
                    error_end = true;
                }
            }

            $('#rob_power_rank').click(function(){
                var params = $.param({"pid":1}) + "&" + $('#rob_form').serialize();
                $.post('/users_manage/rob_rank/', params, function(data) {
                    if ( data.status) {
                        alert("排行榜抢占成功!");
                    }
                    else {
                        alert("排行榜抢占失败!");
                    }

                });

            });

            getSrceenWH();
            //显示弹框
            $('#seize_rank').click(function(){
                className = $(this).attr('class');
                $('#dialogmag_rank').fadeIn(300);
                $('#dialohg_rank').removeAttr('class').addClass('by_value '+className+'').fadeIn();
            });

            //关闭弹窗
            $('.close_rank').click(function(){
                $('#dialogmag_rank').fadeOut(300,function(){
                    $('#dialohg_rank').addClass('bounceOutUp').fadeOut();
                });
            });

            //关闭发货弹窗
            $('.returns').click(function(){
                $('#dialogBg').fadeOut(300,function(){
                    $('#dialog').addClass('bounceOutUp').fadeOut();
                });
            });

            //关闭详情弹窗
            $('.P_cancel').click(function(){
                $('#dialogmag').fadeOut(300,function(){
                    $('#dialohg').addClass('bounceOutUp').fadeOut();
                });
            });

            $("#power_switch").click(function(){
                var rank_status = 0;
                var status = $("#date")[0].checked;
                if (status){
                    rank_status = 1;
                    $("#power_switch").css("background","#CCC");
                    $("#power_switch em").css('float','left');
                }else {
                    $("#power_switch").css("background","#a4d714");
                    $("#power_switch em").css('float','right')
                }
                var data_info = $.param({csrfmiddlewaretoken: '{{ csrf_token }}',"pid":2,"power_switch":rank_status});
                $.post('/users_manage/rob_rank/', data_info, function(data) {
                     if (data.status){
                         alert(data.msg);

                    }
                    else {

                        alert(data.msg);
                    }
                });
            });
        });

        function many_service() {
            className = $(this).attr('class');
            $('#service_mag').fadeIn(300);
            $('#service_hg').removeAttr('class').addClass('animated '+className+'').fadeIn();
        }
    </script>

    <style>
        .audit{display:inline-block;background: #1B9AF7;width: 82px;height: 32px;line-height: 30px;border-radius: 3px; border: 1px solid; text-align: center; margin-left: 20px;}
        *{margin:0;padding:0;list-style-type:none;}
        a,img{border:0;}
        body{font:12px/180% Arial, Helvetica, sans-serif, "新宋体";}
    </style>
</head>
<body>

    <div class="body-div">
        <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="ht_big_bor0">
            <form action="{{url_date}}" method="post" id="form_search">
                {% csrf_token %}
                <tr>
                    <td width="16%" height="40" align="left" valign="middle" bgcolor="#F5F5F5"><strong style="color:#A0A0A0;padding-left:9%;white-space:nowrap;">用户管理 &gt; 魂王争霸赛</strong></td>
                    <td width="60%" align="left" valign="middle" bgcolor="#F5F5F5">
                        <lable for="introduce" style="padding-left: 10px; font-size:12px;">时间:</lable>
                            <input placeholder="请输入日期" id="start" class="laydate-icon" readonly="" value="{{start_day}}" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" name="start_time" style="margin-right: 5px;margin-left: 5px;">
                        <lable for="introduce" style="padding-left: 10px; font-size:12px;">至:</lable>
                            <input placeholder="请输入日期" id="end" class="laydate-icon"  readonly="" value="{{end_day}}" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" name="stop_time" style="margin-right: 20px;margin-left: 5px;">
                        <select name="point_time" class="select_ht_style">
                            {% for info in everyday_list %}
                                 <option value="{{ info.vale }}" {% if status == info.vale %} selected {% endif %} >{{ info.content }}</option>
                            {% endfor %}
                        </select>
                        <lable for="introduce" style="padding-left: 10px; font-size:12px;">玩家ID:</lable>
                        <input placeholder="" class="player_id" name="uid" value="{{ uid }}" style="border: 1px solid #C6C6C6; margin-right: 20px;margin-left: 20px;height: 28px;">
                        <input type="button" value="确认查询" id="query_data" class="button" style="margin-right: 20px;margin-left: 20px;">
                    </td>
                    <td width="14%" align="center" valign="middle" bgcolor="#F5F5F5" class="w_update">
                        <a href="javascript:;" class="button_color" id="seize_rank" style="float: left;line-height: 30px;background: #00EE00;">抢占排行榜</a>
                    </td>
                    <td width="10%" align="center" valign="middle" bgcolor="#F5F5F5" class="w_update">
{#                        {% if page.paginator.num_pages %}#}
{#                            <input type="button" value="导出xls" class="button_color" id="export_data" style="margin-left: 20px;"/>#}
{#                        {% else %}#}
{#                            <input type="button" value="导出xls" class="button_color"  style="margin-left: 20px;background-color: #8b8a8a"/>#}
{#                        {% endif %}#}
                    </td>
                </tr>
            </form>
            <tr>
                <td colspan="4" valign="top" bgcolor="#FFFFFF">
                    <form method="post" action="" id="rank_info">
                        {% csrf_token %}
                        <div class='table-cont' id='table-cont' style="margin-bottom: 0px;box-shadow: 3px 1px 3px 0px white;min-height: 618px;">
                            <table width="97%" border="0" align="center" cellpadding="8" cellspacing="1" bgcolor="#DFDFDF" style="margin:30px auto 30px auto;" styler="1px #666 solid " id="userlist">
                            <tbody id="hover_tf">
                                <tr>
                                    <th align="center" bgcolor="#EEEEEE" style="height: 37px;">选择</th>
                                    <th align="center" bgcolor="#EEEEEE" style="height: 37px;">日期</th>
                                    <th align="center" bgcolor="#EEEEEE" style="height: 37px;">玩家ID</th>
                                    <th align="center" bgcolor="#EEEEEE" style="height: 37px;">昵称</th>
                                    <th align="center" bgcolor="#EEEEEE" style="height: 37px;">渠道</th>
                                    <th align="center" bgcolor="#EEEEEE" style="height: 37px;">总充值</th>
                                    <th align="center" bgcolor="#EEEEEE" style="height: 37px;">话费券</th>
                                    <th align="center" bgcolor="#EEEEEE" style="height: 37px;">获得积分</th>
                                    <th align="center" bgcolor="#EEEEEE" style="height: 37px;">商品成本</th>
                                    <th align="center" bgcolor="#EEEEEE" style="height: 37px;">奖励</th>
                                    <th align="center" bgcolor="#EEEEEE" style="height: 37px;">发货状态</th>
                                    <th align="center" bgcolor="#EEEEEE" style="height: 37px;">审核状态</th>
                                    <th align="center" bgcolor="#EEEEEE" style="height: 37px;">操作</th>
                                </tr>
                                {% for info  in page %}
                                    <tr id="hover_tr" bgcolor="#FFFFFF">
                                        {% if info.send_status == 2 %}
                                            <td align="center" valign="middle" style="height: 50px;">
                                                <input type="checkbox" style="display: none;">
                                            </td>
                                        {% else  %}
                                            <td align="center" valign="middle" style="height: 50px;">
                                                <input type="checkbox" name="order_id" id="check{{info.uid}}" value="">
                                            </td>
                                        {% endif %}
                                        <td align="center" valign="middle" style="height: 50px;">{{info.day_time}}</td>
                                        <td align="center" valign="middle" style="height: 50px;">{{info.uid}}</td>
                                        <td align="center" valign="middle" style="height: 50px;">{{info.nick}}</td>
                                        <td align="center" valign="middle" style="height: 50px;">{{info.channel_id | channel_name}}</td>
                                        <td align="center" valign="middle" style="height: 50px;">{{info.pay_total}}</td>
                                        <td align="center" valign="middle" style="height: 50px;">{{info.silver_coupon}}</td>
                                        <td align="center" valign="middle" style="height: 50px;">{{info.point}}</td>
                                        <td align="center" valign="middle" style="height: 50px;">{{ info.cost }}元</td>
                                        {% if info.shop_virtual == 1  %}
                                            {% if info.reward %}
                                                <td align="center" valign="middle" style="height: 50px;">{{info.reward| convert_reward}}</td>
                                            {% else  %}
                                                <td align="center" valign="middle" style="height: 50px;"></td>
                                            {% endif %}
                                        {% else  %}
                                            {% if info.reward.name %}
                                                <td align="center" valign="middle" id="entity{{info.uid}}" style="height: 50px;">
                                                    {{info.reward.name}}
                                                </td>
                                            {% else  %}
                                                <td align="center" valign="middle" style="height: 50px;">
                                                    {{info.reward| convert_reward}}
                                                </td>
                                            {% endif %}
                                        {% endif %}
                                        {% if info.send_status == 0 %}
                                            {% if info.shop_virtual == 1 %}
                                                <td align="center" valign="middle" style="height: 50px;">
                                                    <span class="yx_jz_pub wsh" id="state{{info.uid}}">等待中</span>
                                                </td>
                                                <td align="center" valign="middle" class="w_update" style="width: 100px;">
                                                    <a href="javascript:;" id="no_approve" class="convert{{info.uid}}">审核通过</a>
                                                </td>

                                                <td align="center" valign="middle" class="send_out" style="width: 220px;">
                                                    <a href="javascript:;" id="no_send" class="send{{info.uid}}">发货</a>
                                                    <a href="javascript:;" id="no_send" class="part{{info.uid}}">详情</a>
                                                </td>
                                            {% else  %}
                                                <td align="center" valign="middle" style="height: 50px;">
                                                    <span class="yx_jz_pub wsh" id="state{{info.exchange_id}}">未审核</span>
                                                </td>
                                                <td align="center" valign="middle" class="w_update" style="width: 100px;">
                                                    <a href="javascript:approve('{{info.uid}}','{{info.exchange_id}}','{{info.good_type}}','{{info.pid}}');" id="approve" class="convert{{info.uid}}">审核通过</a>
                                                </td>

                                                <td align="center" valign="middle" class="send_out" style="width: 220px;">
                                                    <a href="javascript:;" id="no_send" class="send{{info.exchange_id}}">发货</a>
                                                    <a href="javascript:;" id="no_send" class="part{{info.exchange_id}}">详情</a>
                                                </td>
                                            {% endif %}

                                        {% elif info.send_status == 1  %}
                                            {% if info.shop_virtual == 1 %}
                                                <td align="center" valign="middle" style="height: 50px;">
                                                    <span class="yx_jz_pub jz" id="state{{info.uid}}">邮件未领取</span>
                                                </td>
                                                <td align="center" valign="middle" class="w_update" style="width: 100px;">
                                                    <a href="javascript:;" id="no_approve" class="convert{{info.uid}}">审核通过</a>
                                                </td>

                                                <td align="center" valign="middle" class="send_out" style="width: 220px;">
                                                    <a href="javascript:;" id="no_send" class="send{{info.uid}}">发货</a>
                                                    <a href="javascript:;" id="no_send" class="part{{info.uid}}">详情</a>
                                                </td>
                                            {% else  %}
                                                <td align="center" valign="middle" style="height: 50px;">
                                                    <span class="yx_jz_pub jz" id="state{{info.exchange_id}}">未发货</span>
                                                </td>
                                                <td align="center" valign="middle" class="w_update" style="width: 100px;">
                                                    <a href="javascript:;" id="approve" style="background: #8B8A8A;" class="convert{{info.exchange_id}}">审核通过</a>
                                                </td>

                                                <td align="center" valign="middle" class="send_out" style="width: 220px;">
                                                    <a href="javascript:send_out_info('{{info.uid}}','{{info.exchange_id}}','{{info.good_type}}','{{info.pid}}');" id="send_out" class="send{{info.order_id}}">发货</a>
                                                    <a href="javascript:;" id="no_send" class="part{{info.exchange_id}}">详情</a>
                                                </td>
                                            {% endif %}
                                        {% else  %}
                                            {% if info.shop_virtual == 1 %}
                                                <td align="center" valign="middle" style="height: 50px;">
                                                    <span class="yx_jz_pub yx">邮件已领取</span>
                                                </td>
                                                <td align="center" valign="middle" class="w_update" style="width: 100px;">
                                                    <a href="javascript:;" id="no_approve" class="convert{{info.uid}}">审核通过</a>
                                                </td>

                                                <td align="center" valign="middle" class="send_out" style="width: 220px;">
                                                    <a href="javascript:;" id="no_send" class="send{{info.uid}}">发货</a>
                                                    <a href="javascript:;" id="no_send" class="part{{info.uid}}">详情</a>
                                                </td>
                                            {% else  %}
                                                <td align="center" valign="middle" style="height: 50px;">
                                                    <span class="yx_jz_pub yx">已发货</span>
                                                </td>
                                                <td align="center" valign="middle" class="w_update" style="width: 100px;">
                                                    <a href="javascript:;" id="no_approve" class="convert{{info.exchange_id}}">审核通过</a>
                                                </td>

                                                <td align="center" valign="middle" class="send_out" style="width: 220px;">
                                                    <a href="javascript:;" id="no_send">发货</a>
                                                    <a href="javascript:particulars('{{info.uid}}','{{info.exchange_id}}');" id="send_out">详情</a>
                                                </td>
                                            {% endif %}
                                        {% endif %}
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        </div>
                        <!--主要内容结束-->
                        <div class="page" style="margin: 0px 27px  0px 10px;">
                            <table width="98%" border="0" align="center" cellpadding="8" cellspacing="1" bgcolor="#DFDFDF" style="margin:auto;">
                                <tr>
                                    <td align="center" bgcolor="#F9F9F9" style="width:34px">
                                        <input type="checkbox" id="check_all"/>&nbsp;
                                    </td>
                                    <td colspan="13" bgcolor="#F9F9F9" >
                                        <a href="javascript:;" class="audit" style="color: #FFF;background: #888888;float: left">全选</a>
                                        {% if page.paginator.num_pages %}
{#                                            <a href="javascript:many_service();" class="audit" style="color: #FFF;float: left">审核通过</a>#}
                                            <a href="javascript:;" class="audit" style="color: #FFF;background: #888888;float: left">审核通过</a>
                                        {% else %}
                                            <a href="javascript:;" class="audit" style="color: #FFF;background: #888888;float: left">审核通过</a>
                                        {% endif %}

                                        <ul class="rank_switch">
                                            <input type="checkbox" name="Storage" id="date" />
                                            <label for="date" id="power_switch"><em></em></label>
                                        </ul>
                                        <span style="color:#F00;line-height: 30px;">【PS：排行榜关闭与开启!】</span>
                                        <table cellspacing="0" cellpadding="0" border="0" style="float: right;">
                                            <tbody>
                                                <tr>
                                                    <!--<td>-->
                                                        <!--<select class="pagination-page-list">-->
                                                            <!--<option>10</option>-->
                                                            <!--<option>20</option>-->
                                                            <!--<option>30</option>-->
                                                            <!--<option>40</option>-->
                                                            <!--<option>50</option>-->
                                                        <!--</select>-->
                                                    <!--</td>-->
                                                    <td>
                                                        <div class="pagination-btn-separator"></div>
                                                    </td>
                                                    {% if page.has_previous %}
                                                        <td>
                                                            <a href="{{url_date}}?page=1" class="l-btn l-btn-small l-btn-plain">
                                                                <span class="l-btn-left l-btn-icon-left">
                                                                    <span class="l-btn-text l-btn-empty">&nbsp;</span>
                                                                    <span class="l-btn-icon pagination-first">&nbsp;</span>
                                                                </span>
                                                            </a>
                                                        </td>
                                                        <td>
                                                            <a href="{{url_date}}?page={{ page.number|add:-1 }}" class="l-btn l-btn-small l-btn-plain">
                                                                <span class="l-btn-left l-btn-icon-left">
                                                                    <span class="l-btn-text l-btn-empty">&nbsp;</span>
                                                                    <span class="l-btn-icon pagination-prev">&nbsp;</span>
                                                                </span>
                                                            </a>
                                                        </td>
                                                    {% else %}
                                                        <td>
                                                            <a href="javascript:void(0)" class="l-btn l-btn-small l-btn-plain l-btn-disabled l-btn-plain-disabled">
                                                                <span class="l-btn-left l-btn-icon-left">
                                                                    <span class="l-btn-text l-btn-empty">&nbsp;</span>
                                                                    <span class="l-btn-icon pagination-first">&nbsp;</span>
                                                                </span>
                                                            </a>
                                                        </td>
                                                        <td>
                                                            <a href="javascript:void(0)" class="l-btn l-btn-small l-btn-plain l-btn-disabled l-btn-plain-disabled">
                                                                <span class="l-btn-left l-btn-icon-left">
                                                                    <span class="l-btn-text l-btn-empty">&nbsp;</span>
                                                                    <span class="l-btn-icon pagination-prev">&nbsp;</span>
                                                                </span>
                                                            </a>
                                                        </td>
                                                    {% endif %}

                                                    <td>
                                                        <div class="pagination-btn-separator"></div>
                                                    </td>
                                                    <td>
                                                        <span style="padding-left:6px;">Page</span>
                                                    </td>
                                                    <td>
                                                        <input class="pagination-num" value="{{number}}" size="2" type="text">
                                                    </td>
                                                    <td>
                                                        <span style="padding-right:6px;">of {{ page.paginator.num_pages }}</span>
                                                    </td>

                                                    <td>
                                                        <div class="pagination-btn-separator"></div>
                                                    </td>
                                                    {% if page.has_next %}
                                                        <td>
                                                            <a href="{{url_date}}?page={{ page.number|add:1 }}" class="l-btn l-btn-small l-btn-plain">
                                                                <span class="l-btn-left l-btn-icon-left">
                                                                    <span class="l-btn-text l-btn-empty">&nbsp;</span>
                                                                    <span class="l-btn-icon pagination-next">&nbsp;</span>
                                                                </span>
                                                            </a>
                                                        </td>
                                                        <td>
                                                            <a href="{{url_date}}?page={{ page.paginator.num_pages }}" class="l-btn l-btn-small l-btn-plain">
                                                                <span class="l-btn-left l-btn-icon-left">
                                                                    <span class="l-btn-text l-btn-empty">&nbsp;</span>
                                                                    <span class="l-btn-icon pagination-last">&nbsp;</span>
                                                                </span>
                                                            </a>
                                                        </td>
                                                    {% else %}
                                                        <td>
                                                            <a href="javascript:void(0)" class="l-btn l-btn-small l-btn-plain l-btn-disabled l-btn-plain-disabled">
                                                                <span class="l-btn-left l-btn-icon-left">
                                                                    <span class="l-btn-text l-btn-empty">&nbsp;</span>
                                                                    <span class="l-btn-icon pagination-next">&nbsp;</span>
                                                                </span>
                                                            </a>
                                                        </td>
                                                        <td>
                                                            <a href="javascript:void(0)" class="l-btn l-btn-small l-btn-plain l-btn-disabled l-btn-plain-disabled">
                                                                <span class="l-btn-left l-btn-icon-left">
                                                                    <span class="l-btn-text l-btn-empty">&nbsp;</span>
                                                                    <span class="l-btn-icon pagination-last">&nbsp;</span>
                                                                </span>
                                                            </a>
                                                        </td>
                                                    {% endif %}
                                                    <td>
                                                        <div class="pagination-btn-separator"></div>
                                                    </td>
                                                    {% if page.has_next or page.has_previous %}
                                                        <td>
                                                            <a href="javascript:void(0)" class="l-btn l-btn-small l-btn-plain" group="" id="paging">
                                                                <span class="l-btn-left l-btn-icon-left">
                                                                    <span class="l-btn-text l-btn-empty">&nbsp;</span>
                                                                    <span class="l-btn-icon pagination-load">&nbsp;</span>
                                                                </span>
                                                            </a>
                                                        </td>
                                                    {% else %}
                                                        <td>
                                                            <a href="javascript:void(0)" class="l-btn l-btn-small l-btn-plain l-btn-disabled l-btn-plain-disabled" group="">
                                                                <span class="l-btn-left l-btn-icon-left">
                                                                    <span class="l-btn-text l-btn-empty">&nbsp;</span>
                                                                    <span class="l-btn-icon pagination-load">&nbsp;</span>
                                                                </span>
                                                            </a>
                                                        </td>
                                                    {% endif %}
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </form>
                </td>
            </tr>
        </table>
    </div>

    <div id="dialogmag_rank"></div>
    <div id="dialohg_rank" class="by_value" style="margin: auto;position: fixed; left: 25%; top: 10%;width: 660px;height:auto;">
        <div class="dialogTophg" style="height: 50px;width: 100%;">
            <p class="htt4">
                魂石争霸排行榜
            </p>
        </div>
        <form action="" method="post" id="rob_form">
            {% csrf_token %}
            <div style="float: left;margin: 15px 15px 15px 10px;">
                <div class="btn_model">
                    <p>玩家ID</p>
                </div>
                <select id="user_id" name="user_id" class="dowp_list_sty" style="float: left;height: 38px;">
                    {% for f_id in f_list %}
                        <option value="{{f_id}}" selected>{{f_id}}</option>
                    {% endfor %}
                </select>
            </div>
            <div style="float: left;margin: 15px 15px 15px 10px;">
                <select id="status" name="status" class="dowp_list_sty" style="float: left;height: 38px;margin-right: 0px;">
                    {% for info in everyday_list %}
                         <option value="{{ info.vale }}" {% if status == info.vale %} selected {% endif %} >{{ info.content }}</option>
                    {% endfor %}
                </select>
                <div class="btn_model">
                    <p>积分</p>
                </div>
                  <input type="text" name="point" id="point" value="" onkeyup="value=value.replace(/[^\d]/g,'')" style="width: 150px;height: 38px;"/>
            </div>

            <div class="btn_select">
                <a href="javascript:;" class="close_rank" id="quxiao">取消</a>
                <a href="javascript:;" id="rob_power_rank">抢占排行榜</a>
            </div>
        </form>
    </div>

    <!--发货弹框-->
    <div id="dialogBg"></div>
    <div id="dialog" class="animated" style="margin: auto;position: fixed; left: 34%; top: 10%;width: 600px;height:auto;">
        <form action="" method="post" id="shipping_info">
            <h5 style="margin:10px;">
                <div style="height: auto;width: auto;text-align: center;">
                    <label style="color:black;font-size: 18px; font-weight: 600;" class="good_name"></label >
                </div>
            </h5>
            <input type="text" style="display: none;" id="order_name" name="good_name" value="" />
            <input type="text" style="display: none;" id="send_good_type" name="good_type" value="" />
            <input type="text" style="display: none;" id="pid" name="pid" value="" />
            <table width="97%" border="0" align="center" cellpadding="10" cellspacing="1" bgcolor="#DFDFDF" style="margin:15px auto 30px auto;" id="userlist">
                <tr>
                    <td align="right" width="20" bgcolor="#F9F9F9"><strong>订单ID：</strong></td>
                    <td bgcolor="#F9F9F9" width="80">
                        <input type="text" name="order_id" id="order_id" readonly="readonly" style="border:none;background:#F9F9F9" value="" />
                    </td>
                </tr>

                <tr>
                    <td align="right" width="20" bgcolor="#F9F9F9"><strong>兑换人ID：</strong></td>
                    <td bgcolor="#F9F9F9" width="80">
                        <input type="text" name="uid" id="user_id" readonly="readonly" style="border:none;background:#F9F9F9" value="" />
                    </td>
                </tr>

                <tr>
                    <td align="right" width="20" bgcolor="#F9F9F9"><strong>姓名：</strong></td>
                    <td bgcolor="#F9F9F9" width="80">
                        <input type="text" name="payer_name" id="payer_name" readonly="readonly" style="border:none;background:#F9F9F9" value="" />
                    </td>
                </tr>
                <tr>
                    <td width="20" align="right" bgcolor="#F9F9F9"><strong>地区：</strong></td>
                    <td bgcolor="#F9F9F9" width="80">
                        <input type="text" name="area" id="area" readonly="readonly" style="border:none;background:#F9F9F9;width:100%;" value="" />
                    </td>
                </tr>

                <tr>
                    <td align="right" width="20" bgcolor="#F9F9F9"><strong>地址：</strong></td>
                    <td bgcolor="#F9F9F9" width="80">
                        <input type="text" name="address" id="address" readonly="readonly" style="border:none;background:#F9F9F9;width:100%;" value="" />
                    </td>
                </tr>

                <tr>
                    <td align="right" width="20" bgcolor="#F9F9F9"><strong>手机号码：</strong></td>
                    <td bgcolor="#F9F9F9" width="80">
                        <input type="text" name="phone" id="phone" readonly="readonly" style="border:none;background:#F9F9F9" value="" />
                    </td>
                </tr>
                <tr id="express_number_show">
                    <td align="right" width="20" bgcolor="#F9F9F9" ><strong>快递单号：</strong></td>
                    <td bgcolor="#E3F8FF" width="80" class="cursor"><input type="text" name="express_number" value="" id="express_number" /></td>
                </tr>

                <tr id="card_number_show">
                    <td align="right" width="20" bgcolor="#F9F9F9"><strong>卡号：</strong></td>
                    <td bgcolor="#F9F9F9" width="80" class="cursor"><input type="text" name="card_number" value="" id="card_number" readonly="readonly" style="border:none;background:#F9F9F9" /></td>
                </tr>

                <tr id="card_close_show">
                    <td align="right" width="20" bgcolor="#F9F9F9"><strong>卡密：</strong></td>
                    <td bgcolor="#F9F9F9" width="80" class="cursor"><input type="text" name="card_close" value="" id="card_close" readonly="readonly" style="border:none;background:#F9F9F9"/></td>
                </tr>

            </table>

            <div class="btn_select" style="height: 60px;border-top: 1px dotted #ccc;">
                  <input  type="button" class="returns" style=" margin-top:15px; float: right;margin-right: 10px;color: rgba(0,0,0,.8);background: #cacbcd;" value="取消" >
                  <input id="send_info" type="button" style="float: right;margin-right: 10px; margin-top:15px;" value="确定发货" class="confirm" onclick="send_out_status()">
             </div>
        </form>
    </div>


    <div id="dialogmag"></div>
    <div id="dialohg" class="animated" style="margin: auto;position: fixed; left: 34%; top: 10%;width: 600px;height:auto;">
        <form action="" method="post" id="details">
            <table width="97%" border="0" align="center" cellpadding="10" cellspacing="1" bgcolor="#DFDFDF" style="margin:30px auto 30px auto;" >
                <tr>
                    <td align="right" width="20" bgcolor="#F9F9F9"><strong>订单ID：</strong></td>
                    <td bgcolor="#F9F9F9" width="80">
                        <input type="text" name="order_id" id="order_id_part" readonly="readonly" style="border:none;background:#F9F9F9" value="" />
                    </td>
                </tr>

                <tr>
                    <td align="right" width="20" bgcolor="#F9F9F9"><strong>兑换人ID：</strong></td>
                    <td bgcolor="#F9F9F9" width="80">
                        <input type="text" name="uid" id="user_id_part" readonly="readonly" style="border:none;background:#F9F9F9" value="" />
                    </td>
                </tr>

                <tr>
                    <td align="right" width="20" bgcolor="#F9F9F9"><strong>姓名：</strong></td>
                    <td bgcolor="#F9F9F9" width="80">
                        <input type="text" name="payer_name" id="name_part" readonly="readonly" style="border:none;background:#F9F9F9" value="" />
                    </td>
                </tr>

                <tr>
                    <td width="20" align="right" bgcolor="#F9F9F9"><strong>地区：</strong></td>
                    <td bgcolor="#F9F9F9" width="80">
                        <input type="text" name="area" id="area_part" readonly="readonly" style="border:none;background:#F9F9F9;width:100%; " value="" />
                    </td>
                </tr>

                <tr>
                    <td align="right" width="20" bgcolor="#F9F9F9"><strong>地址：</strong></td>
                    <td bgcolor="#F9F9F9" width="80">
                        <input type="text" name="address" id="address_part" readonly="readonly" style="border:none;background:#F9F9F9; width:100%;" value="" />
                    </td>
                </tr>

                <tr id="express_number_part">
                    <td align="right" width="20" bgcolor="#F9F9F9" ><strong>快递单号：</strong></td>
                    <td bgcolor="#F9F9F9" width="80" class="cursor">
                        <input type="text" name="express_number" id="express_number_data" readonly="readonly" style="border:none;background:#F9F9F9" value="" />
                    </td>
                </tr>

                <tr id="card_number_part">
                    <td align="right" width="20" bgcolor="#F9F9F9"><strong>卡号：</strong></td>
                    <td bgcolor="#F9F9F9" width="80" class="cursor"><input type="text" name="card_number" value="" id="card_number_data" readonly="readonly" style="border:none;background:#F9F9F9" /></td>
                </tr>

                <tr id="card_close_part">
                    <td align="right" width="20" bgcolor="#F9F9F9"><strong>卡密：</strong></td>
                    <td bgcolor="#F9F9F9" width="80" class="cursor"><input type="text" name="card_close" value="" id="card_close_data" readonly="readonly" style="border:none;background:#F9F9F9"/></td>
                </tr>
            </table>

            <div class="btn_select" style="height: 60px; border-top: 1px dotted #ccc;">
                  <input  type="button" class="P_cancel" style="width: 80px;height: 35px; margin-top:15px; float: right;margin-right: 30px;color: rgba(0,0,0,.8);background: #cacbcd;" value="取消" >
             </div>
        </form>
    </div>

    <!--客服多个审核通过弹框-->
    <div id="service_mag"></div>
    <div id="service_hg" class="animated" style="margin: auto;position: fixed; left: 34%; top: 10%;width: 520px;height:auto;">
        <form id="one_info">
            {% csrf_token %}
            <div class="dialogTophg" style="height: 30px;width: 100%;">
                <h4  style="text-align: left; margin-left: 16px; font-size: 20px;font-weight: 800;margin-top: 6px;">
                    请选择：
                </h4>
            </div>
            <ul class="editInfos">
                <div class="btn_select" style="height: 40px; margin-top: 30px;">
                    <a href="javascript:;" id="service_Approve" style="margin-left: 75px;background:#1B9AF7">审核通过</a>
                    <a href="javascript:;" class="E_cancel" style="float: right; margin-right: 80px;color: rgba(0,0,0,.8);background: #cacbcd;">取消</a>
                </div>
            </ul>
        </form>
    </div>

    <script>
        !function(){
        laydate.skin('molv');//切换皮肤，请查看skins下面皮肤库
        laydate({elem: '#demo'});//绑定元素
        }();
        //日期范围限制
        var start = {
            elem: '#start',
            format: 'YYYY-MM-DD hh:mm:ss',
            //min: laydate.now(), //设定最小日期为当前日期
            max: '2099-06-16', //最大日期
            istime: true,
            istoday: false,
            choose: function(datas){
                 end.min = datas; //开始日选好后，重置结束日的最小日期
                 end.start = datas //将结束日的初始值设定为开始日
            }
        };
        var end = {
            elem: '#end',
            format: 'YYYY-MM-DD hh:mm:ss',
            // min: laydate.now(),
            max: '2099-06-16',
            istime: true,
            istoday: false,
            choose: function(datas){
                start.max = datas; //结束日选好后，充值开始日的最大日期
            }
        };

        var valid = {
            elem: '#valid',
            format: 'YYYY-MM-DD hh:mm:ss',
            // min: laydate.now(),
            max: '2099-06-16',
            istime: true,
            istoday: false,
            choose: function(datas){
                start.max = datas; //结束日选好后，充值开始日的最大日期
            }
        };
        laydate(start); //valid
        laydate(end);
        laydate(valid);
        //自定义日期格式
        laydate({
            elem: '#test1',
            format: 'YYYY年MM月DD日',
            festival: true, //显示节日
            choose: function(datas){ //选择日期完毕的回调
                alert('得到：'+datas);
            }
        });
        //日期范围限定在昨天到明天
        laydate({
            elem: '#hello3',
            min: laydate.now(-1), //-1代表昨天，-2代表前天，以此类推
            max: laydate.now(+1) //+1代表明天，+2代表后天，以此类推
        });

        function approve(uid,order_id,good_type,pid) {
            var params = $.param({csrfmiddlewaretoken: '{{ csrf_token }}',"pid":3,"status":1,"user_ID":uid,"exchange_id":order_id,"good_type":good_type,"Pid":pid});
            $.post('/limit_time_shop/alter_check_status/', params, function(data) {
                if ( data.status) {
                    $.each(data.u_list, function(i, value){
                        var exchange_id = value.exchange_id;
                        var user_id = value.user_id;
                        var good_type = value.good_type;
                        var pid = value.pid;
                        $(".convert"+exchange_id).attr("href","javascript:;");
                        $(".convert"+exchange_id).css("background", "#8B8A8A");
                        $(".send"+exchange_id).attr("href","javascript:send_out_info("+user_id+","+exchange_id+","+good_type+","+pid+");");
                        $(".send"+exchange_id).css("background", "#1B9AF7");
                        $("#state"+exchange_id).removeClass("wsh");
                        $("#state"+exchange_id).addClass("jz");
                        $("#state"+exchange_id).html("未发货");
                    });
                    $('#service_mag').fadeOut(300,function(){
                        $('#service_hg').addClass('bounceOutUp').fadeOut();
                    });
                }
                else {
                    alert("数据异常!");
                }
            });
        }

        function send_out_info(uid,order_id,good_type,pid) {
            var good_name = $("#entity"+ uid).html();
            //显示发货弹框
            $.post('/limit_time_shop/deal_shipping/', {csrfmiddlewaretoken: '{{ csrf_token }}',"shop_id":1,"uid":uid,"order":order_id,"good_type":good_type,"pid":pid}, function(data) {
                if (data.status) {
                    alert(data.msg);
                    var good_type = data.good_info.good_type;
                    var pid = data.good_info.pid;
                    var order = data.good_info.order;
                    var uid = data.good_info.uid;
                    var name = data.ship_info.name;
                    var area = data.ship_info.area;
                    var address = data.ship_info.address;
                    var phone = data.ship_info.phone;
                    if(good_type == 1 || good_type == 5){
                        $("#express_number_show").show();
                        $("#card_number_show").hide();
                        $("#card_close_show").hide();
                    }
                    else if(good_type == 4 || good_type == -1){
                        $("#card_number_show").show();
                        $("#card_close_show").show();
                        $("#express_number_show").hide();
                        card_number = hideCard(data.card_number,0,0);
                        $("#card_number").val(card_number);
                        card_data = hideCard(data.card_secret,0,0);
                        $("#card_close").val(card_data);

                    }
                    else{
                        $("#express_number_show").hide();
                        $("#card_number_show").hide();
                        $("#card_close_show").hide();
                    }
                    $(".good_name").html(good_name);
                    $("#order_name").val(good_name);
                    $("#send_good_type").val(good_type);
                    $("#pid").val(pid);
                    $("#order_id").val(order);
                    $("#user_id").val(uid);
                    $("#payer_name").val(name);

                    $("#area").val(area);
                    $("#address").val(address);
                    $("#phone").val(phone);

                    className = $(this).attr('class');
                    $('#dialogBg').fadeIn(300);
                    $('#dialog').removeAttr('class').addClass('animated '+className+'').fadeIn();
                }
                else {
                    alert(data.msg);
                }
            });
        }

        function send_out_status() {
            var data_info = $.param({csrfmiddlewaretoken: '{{ csrf_token }}'}) + "&" + $("#shipping_info").serialize();
            var order_id = $("#order_id").val();
            var user_id = $("#user_id").val();
            var express_number = $("#express_number").val();
            var good_type = parseInt($("#send_good_type").val());

            if (good_type == 1 || good_type == 5){
                if (express_number.length == 0){
                    alert("快递单号不能为空！");
                }else {
                    if(confirm("您确定发货？")){
                        $.post('/limit_time_shop/alter_shipping_status/', data_info, function(data) {
                            if (data.code) {
                                alert(data.msg);
                                $(".send"+order_id).attr("href","javascript:;");
                                $(".send"+order_id).css("background", "#8B8A8A");
                                $(".part"+order_id).attr("href","javascript:particulars("+user_id+","+order_id+");");
                                $(".part"+order_id).css("background", "#1B9AF7");
                                $("#state"+order_id).removeClass("jz");
                                $("#state"+order_id).addClass("yx");
                                $("#state"+order_id).html("已发货");
                                $("#time"+order_id).html(data.uptime);
                                $("#check"+order_id).css('display','none');

                                $('#dialogBg').fadeOut(300,function(){
                                    $('#dialog').addClass('bounceOutUp').fadeOut();
                                });
                            }else {
                                alert(data.msg);
                            }
                    });
                    }else {
                        alert("您取消了发货");
                    }
                }
            }
            else if (good_type == 4 || good_type == -1) {
                number_name = parseInt($("#card_number").val());
                close_name = parseInt($("#card_close").val());
                if (number_name.length == 0 || close_name.length == 0 ){
                    alert("卡密和卡号已使用完,请上传卡密和卡号！");
                }else {
                    if(confirm("您确定发货？")){
                        $.post('/limit_time_shop/alter_shipping_status/', data_info, function(date) {
                            if ( date.code) {
                                alert(date.msg);
                                $(".send"+order_id).attr("href","javascript:;");
                                $(".send"+order_id).css("background", "#8B8A8A");
                                $(".part"+order_id).attr("href","javascript:particulars("+user_id+","+order_id+");");
                                $(".part"+order_id).css("background", "#1B9AF7");
                                $("#state"+order_id).removeClass("jz");
                                $("#state"+order_id).addClass("yx");
                                $("#state"+order_id).html("已发货");
                                $("#time"+order_id).html(date.uptime);
                                $("#check"+order_id).css('display','none');

                                $('#dialogBg').fadeOut(300,function(){
                                    $('#dialog').addClass('bounceOutUp').fadeOut();
                                });
                            }else {
                                alert(date.msg);
                            }
                        });
                    }else {
                        alert("您取消了发货");
                    }
                }
            }
            else {
                if(confirm("您确定发货？")){
                    $.post('/limit_time_shop/alter_shipping_status/', data_info, function(date) {
                        if ( date.code) {
                            alert(date.msg);
                            $(".send"+order_id).attr("href","javascript:;");
                            $(".send"+order_id).css("background", "#8B8A8A");
                            $(".part"+order_id).attr("href","javascript:particulars("+user_id+","+order_id+");");
                            $(".part"+order_id).css("background", "#1B9AF7");
                            $("#state"+order_id).removeClass("jz");
                            $("#state"+order_id).addClass("yx");
                            $("#state"+order_id).html("已发货");
                            $("#time"+order_id).html(date.uptime);
                            $("#check"+order_id).css('display','none');

                            $('#dialogBg').fadeOut(300,function(){
                                $('#dialog').addClass('bounceOutUp').fadeOut();
                            });
                        }else {
                            alert(date.msg);
                        }
                    });
                }else {
                    alert("您取消了发货");
                }
            }
        }

        function particulars(uid,order_id) {
            $.post('/limit_time_shop/deal_shipping/', {csrfmiddlewaretoken:'{{ csrf_token }}',"shop_id":2,"uid":uid,"order":order_id}, function(data) {
                if (data.status) {
                    var good_type = data.good_type;
                    var order = data.order;
                    var uid = data.uid;
                    var name = data.name;
                    var area = data.area;
                    var address = data.address;
                    var mail = data.mail;
                    var phone = data.phone;
                    if(good_type == 1 || good_type == 5){
                        $("#express_number_part").show();
                        $("#card_number_part").hide();
                        $("#card_close_part").hide();
                        $("#express_number_data").val(data.send.express_number);
                    }
                    else if(good_type == 4 || good_type == -1){
                        $("#card_number_part").show();
                        $("#card_close_part").show();
                        $("#express_number_part").hide();
                        $("#card_number_data").val(data.send.card_number);
                        card_info = hideCard(data.send.card_close,0,0);
                        $("#card_close_data").val(card_info);
                    }
                    else{
                        $("#express_number_part").hide();
                        $("#card_number_part").hide();
                        $("#card_close_part").hide();
                    }
                    $("#order_id_part").val(order);
                    $("#user_id_part").val(uid);
                    $("#name_part").val(name);
                    $("#area_part").val(area);
                    $("#address_part").val(address);
                    $("#phone_part").val(phone);
                    $("#mail_part").val(mail);

                    className = $(this).attr('class');
                    $('#dialogmag').fadeIn(300);
                    $('#dialohg').removeAttr('class').addClass('animated '+className+'').fadeIn();
                }
                else {
                    alert(data.msg);
                }

            });
        }

        function hideCard (str,frontLen,endLen) {
            var len = str.length-frontLen-endLen;
            var xing = '';
            for (var i=0;i<len;i++) {
                xing+='*';
            }
            return str.substring(0,frontLen)+xing+str.substring(str.length-endLen);
        }

        $(function () {
            if({{ rank_switch }}==0){
                $("#power_switch").css("background","#a4d714");
                $("#power_switch em").css('float','right');
                $("#date").attr("checked",'false');
            }
        });
    </script>
</body>
</html>